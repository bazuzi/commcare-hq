{% extends "settings/bootstrap3/base_template.html" %}
{% load i18n %}
{% load hqstyle_tags %}
{% load hq_shared_tags %}
{% load crispy_forms_tags %}

{% block js-inline %} {{ block.super }}
    <script type="text/javascript">
        $(function() {
            var $testLinkButton = $('<a style="margin-left: 5px;" class="btn btn-info hide" href="#" />'),
                     $testLabel = $('<span style="margin-left: 5px;" class="label" />');
            $testLinkButton.text("{% trans 'Test Link' %}");
            $testLinkButton.click(function () {
                var url = $("#id_url").val(),
                    format = $("#id_format").val(),
                    type = {{ repeater_type|to_javascript_string }},
                    data = {url: url, repeater_type: type, format: format};
                jQuery.post("{% url "test_repeater" domain %}", data, function(data) {
                    json_res = JSON.parse(data);
                    $testLabel.removeClass("hide label-danger label-success");
                    if (json_res.status) {
                        msg = json_res.status + ": " + json_res.response;
                    } else {
                        msg = json_res.response;
                    }
                    if (json_res.success) {
                        $testLabel.addClass("label-success");
                        $testLabel.text("{% trans 'Success! Response is' %}: " + msg);
                    } else {
                        $testLabel.addClass("label-danger");
                        $testLabel.text("{% trans 'Failed! Response is' %}: " + msg);
                    }
                });
            });
            $('#id_url').after($testLinkButton);
            $testLinkButton.after($testLabel.addClass('hide'));
            $('#id_url').change(function () {
                if ($(this).val()) {
                    $testLinkButton.removeClass('hide');
                } else {
                    $testLinkButton.addClass('hide');
                }
            });
        });
    </script>
{% endblock %}

{% block page_content %}
    {% crispy form %}
{% endblock %}
